# firebase-vk-telegram-post-bot

Бот для Firebase functions. Репостит посты из группы VK в канал Telegram.

## Установка

```
npm run install
```

- Настроить конфиг /functions/config/index.js
  - Переименовать index_example.js в index.js
  - В настройках проекта Firebase создать закрытый ключ для сервисного аккаунта и вставить данные в свойство googleCredentials
  - Добавить в массив `bots` данные телеграмм и вконтакте для каждого бота
- В проекте Firebase на сайте сменить тарифный план на Blaze(Оплата по мере использования). Необходимо для отправки данных с серверов firebase на сервера телеграмма

```
npm install -g firebase-tools
firebase login
firebase projects:list
firebase use [Project ID]
firebase deploy --only functions
```

### OPTIONAL

- Добавить ограничения на пересылку постов
  - Создать коллекцию `restrictions` в Firebase Firestore. Для каджого бота добавляем отдельный документ. Поле _botName_ должно совпадать с свойством _botName_ в конфиге вашего бота.
    Существующие ограничения в порядке уменьшения приоритета: allowedTags, deniedTags, allowedAuthors, forwardAllPosts
    ![Пример с необходимыми полями](/firestore_restrictions_example.jpg)

### TIPS

- Как получить данные ВК группы
  - В настройках группы ВК перейти на страницу Работа с API
  - Перейти во вкладку Callback API
  - Заполнить адрес, который можно найти в проекте Firebase в functions после деплоя функций
  - Там же получить _groupId_, _callbackString_ и _secret_
  - Нажать Подтвердить. Если неудачно, то проверить все ли конфиги заполнены и функции задеплоены
  - Во вкладе _Типы событий_ выделить _Записи на стене - Добавление_
- Как получить данные Телеграмм
  - Создать вашего бота в телеграмме через бота **@BotFather** и получить _botToken_
  - Залогиниться в Телеграмм через браузер https://web.telegram.org, перейти в ваш канал и в адресной строке найти часть похожую на `c12112121212_17878787878787878`, где к `12112121212` добавляем `-100` и получаем `-10012112121212` наш _channelId_. Если подобных чисел в адресной строке нет, то в настройках канала делаем его приватным и пробуем снова, а после получения убираем приватность
